<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro por Proceso | PROD-SYS</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui-utils.js"></script>
    <style>
        .grid-temps {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
        }
        .section-extrusor { display: none; }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <span>PROD-SYS</span>
                <button id="btn-toggle-sidebar" class="btn-icon" title="Contraer/Expandir">
                    <i data-lucide="menu"></i>
                </button>
            </div>
            <nav class="sidebar-nav">
                <a href="/" class="nav-item">
                    <i data-lucide="layout-dashboard"></i>
                    <span>Dashboard</span>
                </a>
                <div class="nav-group-label">Producci√≥n</div>
                <a href="/bitacora.html" class="nav-item active">
                    <i data-lucide="book-open"></i>
                    <span>Bit√°cora de Turno</span>
                </a>
                <a href="/ordenes.html" class="nav-item">
                    <i data-lucide="clipboard-list"></i>
                    <span>√ìrdenes</span>
                </a>
                <a href="/ejecucion.html" class="nav-item">
                    <i data-lucide="play-circle"></i>
                    <span>Ejecuci√≥n</span>
                </a>
                <a href="/incidentes.html" class="nav-item">
                    <i data-lucide="alert-triangle"></i>
                    <span>Incidentes</span>
                </a>
                <div class="nav-group-label">Control y Seguimiento</div>
                <a href="/calidad.html" class="nav-item">
                    <i data-lucide="check-circle"></i>
                    <span>Calidad</span>
                </a>
                <a href="/trazabilidad.html" class="nav-item">
                    <i data-lucide="search"></i>
                    <span>Trazabilidad</span>
                </a>
                <div class="nav-group-label">Sistema</div>
                <a href="/configuracion.html" class="nav-item">
                    <i data-lucide="settings"></i>
                    <span>Configuraci√≥n</span>
                </a>
                <a href="/auditoria.html" class="nav-item">
                    <i data-lucide="shield"></i>
                    <span>Auditor√≠a</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div id="user-display">Usuario: -</div>
                <button onclick="Auth.logout()" class="button button-outline" title="Cerrar Sesi√≥n">
                    <i data-lucide="log-out"></i>
                    <span>Cerrar Sesi√≥n</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar" style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <a href="/bitacora.html" class="button button-outline" style="padding: 0.25rem 0.75rem;">‚Üê Volver</a>
                    <h1 id="proceso-titulo" style="margin-bottom: 0;">Proceso: -</h1>
                    <span id="badge-estado-proceso" class="badge badge-outline">Sin datos</span>
                </div>
                <div id="breadcrumb" style="font-size: 0.875rem; color: var(--text-muted);">
                    Bit√°cora Turno <span id="bread-turno">-</span> ‚Äì <span id="bread-fecha">-</span>  >  <span id="bread-proceso">-</span>
                </div>
            </header>

            <div class="page-content">

                <!-- SECCI√ìN: ESTADO DEL PROCESO -->
                <div class="card" style="border-left: 5px solid var(--warning);">
                    <div class="card-title">ESTADO DEL PROCESO</div>
                    <div style="display: flex; gap: 2rem; align-items: flex-start;">
                        <div class="form-group" style="flex: 1;">
                            <label for="select-operatividad">Disponibilidad</label>
                            <select id="select-operatividad" class="form__input">
                                <option value="operativo">‚úÖ Operativo (Producci√≥n normal)</option>
                                <option value="no_operativo">üö´ No Operativo (Parada / Sin plan)</option>
                            </select>
                        </div>
                        <div id="group-motivo" class="form-group" style="flex: 2; display: none;">
                            <label for="motivo-no-operativo">Motivo de no operatividad</label>
                            <input type="text" id="motivo-no-operativo" class="form__input" placeholder="Ej. Falta de personal, sin programaci√≥n de √≥rdenes...">
                        </div>
                    </div>
                </div>

                <div id="secciones-operativas">

                    <!-- 1. CALIDAD -->
                    <div class="card">
                        <div class="card-title">1. CALIDAD (Muestras)</div>

                        <!-- Contenedor para muestras de Extrusor PP -->
                        <div id="calidad-extrusor" class="section-extrusor">
                            <div class="table-container mb-4">
                                <table id="tabla-calidad-extrusor">
                                    <thead>
                                        <tr>
                                            <th>Ronda</th>
                                            <th>Tipo</th>
                                            <th>Denier</th>
                                            <th>Resistencia (gf)</th>
                                            <th>% Elong.</th>
                                            <th>Tenacidad (gf/den)</th>
                                            <th>Ancho (mm)</th>
                                            <th>Color</th>
                                            <th>Estado</th>
                                            <th>‚öôÔ∏è</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbody-calidad-extrusor"></tbody>
                                </table>
                            </div>
                            <button id="btn-agregar-muestra-extrusor" class="button button-outline">+ Agregar Muestra</button>
                        </div>

                        <!-- Contenedor para muestras Gen√©rico -->
                        <div id="calidad-generico">
                            <div class="table-container mb-4">
                                <table id="tabla-calidad">
                                    <thead>
                                        <tr>
                                            <th>Par√°metro</th>
                                            <th>Valor</th>
                                            <th>Resultado</th>
                                            <th>Acci√≥n</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbody-calidad"></tbody>
                                </table>
                            </div>
                            <button id="btn-agregar-muestra" class="button button-outline">+ Agregar Muestra</button>
                        </div>
                    </div>

                    <!-- 2. MATERIAS PRIMAS / MEZCLA (Extrusor PP Only) -->
                    <div id="seccion-materias-primas" class="card section-extrusor">
                        <div class="card-title">2. MATERIAS PRIMAS / MEZCLA</div>
                        <div class="table-container mb-4">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tipo</th>
                                        <th>Marca</th>
                                        <th>Lote</th>
                                        <th>Porcentaje (%)</th>
                                    </tr>
                                </thead>
                                <tbody id="tbody-mezcla">
                                    <!-- 6 filas fijas o din√°micas -->
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="3" style="text-align: right; font-weight: bold;">TOTAL:</td>
                                        <td id="total-mezcla" style="font-weight: bold;">0%</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div id="warning-mezcla" class="text-error" style="display: none;">‚ö† La suma debe ser exactamente 100%</div>
                    </div>

                    <!-- 3. PRODUCCI√ìN -->
                    <div class="card">
                        <div class="card-title"><span class="label-orden-seccion">3</span>. PRODUCCI√ìN DEL TURNO</div>
                        <div class="table-container mb-4">
                            <table id="tabla-produccion">
                                <thead>
                                    <tr>
                                        <th>M√°quina</th>
                                        <th>Orden</th>
                                        <th>Producci√≥n (kg)</th>
                                        <th style="width: 50px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="tbody-produccion"></tbody>
                            </table>
                        </div>
                        <button id="btn-agregar-produccion" class="button button-outline">+ Agregar Registro</button>
                    </div>

                    <!-- 4. DESPERDICIO -->
                    <div class="card">
                        <div class="card-title"><span class="label-orden-seccion">4</span>. DESPERDICIO</div>
                        <div class="table-container mb-4">
                            <table id="tabla-desperdicio">
                                <thead>
                                    <tr>
                                        <th>M√°quina</th>
                                        <th>Orden</th>
                                        <th>Desperdicio (kg)</th>
                                        <th>Tipo/Motivo</th>
                                        <th style="width: 50px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="tbody-desperdicio"></tbody>
                            </table>
                        </div>
                        <button id="btn-agregar-desperdicio" class="button button-outline">+ Agregar Desperdicio</button>
                    </div>

                    <!-- 5. INCIDENTES Y PAROS (Extrusor PP Only o General) -->
                    <div id="seccion-incidentes" class="card">
                        <div class="card-title"><span class="label-orden-seccion">5</span>. INCIDENTES Y PAROS</div>
                        <div class="table-container mb-4">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tiempo Paro (min)</th>
                                        <th>Motivo</th>
                                        <th>Clasificaci√≥n</th>
                                        <th style="width: 50px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="tbody-incidentes"></tbody>
                            </table>
                        </div>
                        <button id="btn-agregar-incidente" class="button button-outline">+ Registrar Paro/Incidente</button>
                    </div>

                </div>

                <!-- 6. OBSERVACIONES -->
                <div class="card">
                    <div class="card-title"><span class="label-orden-seccion">6</span>. OBSERVACIONES</div>
                    <div class="form-group">
                        <label for="observaciones">Notas del Inspector</label>
                        <textarea id="observaciones" rows="4" placeholder="Escriba aqu√≠ cualquier desviaci√≥n, rechazo o incidente..."></textarea>
                    </div>
                    <div id="aviso-obligatorio" class="text-error" style="display: none; font-size: 0.875rem; margin-top: -0.5rem; margin-bottom: 1rem;">
                        ‚ö† Las observaciones son obligatorias cuando hay rechazos o desviaciones.
                    </div>
                </div>

                <!-- BOTONES FINALES -->
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-bottom: 4rem;">
                    <button id="btn-guardar" class="button button-outline">Guardar</button>
                    <button id="btn-guardar-volver" class="button button-primary">Guardar y volver</button>
                </div>

            </div>
        </main>
    </div>

    <script src="js/proceso.js"></script>

</body>
</html>
